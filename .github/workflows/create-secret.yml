name: secret create
on:
  push:
    branches: [ "main" ]
jobs:
  secret:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Get ENV
        run: |        
          TOKEN=${{ secrets.GIT_TOKEN }}
          REPO=${{ github.repository }}
          FILE_PATH=ninja-training-cluster.config
           
           # To Create a repository secret
          # curl -X PUT \
          #-H "Authorization: token $TOKEN" \
          #-H "Accept: application/vnd.github.v3+json" \
          #-H "Content-Type: application/json" \
          #-d @- \
          #"https://api.github.com/repos/${{ github.repository }}/actions/secrets/KUBECONFIGTEST" <<EOF
          #{
          #"encrypted_value": "$(base64 -w 0 $FILE_PATH)",
          #"key_id": "568250167242549743"
          # }
          #EOF       
          
          curl -L \
          -X PUT \
          -H "Accept: application/vnd.github.v3+json" \
          -H "Authorization: token $TOKEN" \
          https://api.github.com/repos/${{ github.repository }}/actions/secrets/TEST \
          -d '{"encrypted_value": "$(base64 -w 0 $FILE_PATH)","key_id": "568250167242549743"}'
  
      - name: Set up Kubernetes
        uses: azure/k8s-set-context@v1
        with:
          kubeconfig: ${{ secrets.TEST }}        
      - name: List Secret
        run: |
          echo "ns from new secret"
          kubectl get ns  
        
